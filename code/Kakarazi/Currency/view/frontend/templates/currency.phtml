<?php
$currencyHelper = $this->helper('Kakarazi\Currency\Helper\Data');
$currencyRates = $currencyHelper->getCurrencyRates();
$currencyRates = $currencyRates ? $currencyRates : array();
$currencyList = array_keys($currencyRates);
$currentDate = date('d/m/Y');

$currencyNames = [
    "AED" => "United Arab Emirates Dirham",
    "AFN" => "Afghan Afghani",
    "ALL" => "Albanian Lek",
    "AMD" => "Armenian Dram",
    "ANG" => "Netherlands Antillean Guilder",
    "AOA" => "Angolan Kwanza",
    "ARS" => "Argentine Peso",
    "AUD" => "Australian Dollar",
    "AWG" => "Aruban Florin",
    "AZN" => "Azerbaijani Manat",
    "BAM" => "Bosnia-Herzegovina Convertible Mark",
    "BBD" => "Barbadian Dollar",
    "BDT" => "Bangladeshi Taka",
    "BGN" => "Bulgarian Lev",
    "BHD" => "Bahraini Dinar",
    "BIF" => "Burundian Franc",
    "BMD" => "Bermudan Dollar",
    "BND" => "Brunei Dollar",
    "BOB" => "Bolivian Boliviano",
    "BRL" => "Brazilian Real",
    "BSD" => "Bahamian Dollar",
    "BTC" => "Bitcoin",
    "BTN" => "Bhutanese Ngultrum",
    "BWP" => "Botswanan Pula",
    "BYN" => "New Belarusian Ruble",
    "BYR" => "Belarusian Ruble",
    "BZD" => "Belize Dollar",
    "CAD" => "Canadian Dollar",
    "CDF" => "Congolese Franc",
    "CHF" => "Swiss Franc",
    "CLF" => "Chilean Unit of Account (UF)",
    "CLP" => "Chilean Peso",
    "CNY" => "Chinese Yuan",
    "CNH" => "Chinese Yuan Offshore",
    "COP" => "Colombian Peso",
    "CRC" => "Costa Rican Colón",
    "CUC" => "Cuban Convertible Peso",
    "CUP" => "Cuban Peso",
    "CVE" => "Cape Verdean Escudo",
    "CZK" => "Czech Republic Koruna",
    "DJF" => "Djiboutian Franc",
    "DKK" => "Danish Krone",
    "DOP" => "Dominican Peso",
    "DZD" => "Algerian Dinar",
    "EGP" => "Egyptian Pound",
    "ERN" => "Eritrean Nakfa",
    "ETB" => "Ethiopian Birr",
    "EUR" => "Euro",
    "FJD" => "Fijian Dollar",
    "FKP" => "Falkland Islands Pound",
    "GBP" => "British Pound Sterling",
    "GEL" => "Georgian Lari",
    "GGP" => "Guernsey Pound",
    "GHS" => "Ghanaian Cedi",
    "GIP" => "Gibraltar Pound",
    "GMD" => "Gambian Dalasi",
    "GNF" => "Guinean Franc",
    "GTQ" => "Guatemalan Quetzal",
    "GYD" => "Guyanaese Dollar",
    "HKD" => "Hong Kong Dollar",
    "HNL" => "Honduran Lempira",
    "HRK" => "Croatian Kuna",
    "HTG" => "Haitian Gourde",
    "HUF" => "Hungarian Forint",
    "IDR" => "Indonesian Rupiah",
    "ILS" => "Israeli New Sheqel",
    "IMP" => "Manx pound",
    "INR" => "Indian Rupee",
    "IQD" => "Iraqi Dinar",
    "IRR" => "Iranian Rial",
    "ISK" => "Icelandic Króna",
    "JEP" => "Jersey Pound",
    "JMD" => "Jamaican Dollar",
    "JOD" => "Jordanian Dinar",
    "JPY" => "Japanese Yen",
    "KES" => "Kenyan Shilling",
    "KGS" => "Kyrgystani Som",
    "KHR" => "Cambodian Riel",
    "KMF" => "Comorian Franc",
    "KPW" => "North Korean Won",
    "KRW" => "South Korean Won",
    "KWD" => "Kuwaiti Dinar",
    "KYD" => "Cayman Islands Dollar",
    "KZT" => "Kazakhstani Tenge",
    "LAK" => "Laotian Kip",
    "LBP" => "Lebanese Pound",
    "LKR" => "Sri Lankan Rupee",
    "LRD" => "Liberian Dollar",
    "LSL" => "Lesotho Loti",
    "LTL" => "Lithuanian Litas",
    "LVL" => "Latvian Lats",
    "LYD" => "Libyan Dinar",
    "MAD" => "Moroccan Dirham",
    "MDL" => "Moldovan Leu",
    "MGA" => "Malagasy Ariary",
    "MKD" => "Macedonian Denar",
    "MMK" => "Myanma Kyat",
    "MNT" => "Mongolian Tugrik",
    "MOP" => "Macanese Pataca",
    "MRU" => "Mauritanian Ouguiya",
    "MUR" => "Mauritian Rupee",
    "MVR" => "Maldivian Rufiyaa",
    "MWK" => "Malawian Kwacha",
    "MXN" => "Mexican Peso",
    "MYR" => "Malaysian Ringgit",
    "MZN" => "Mozambican Metical",
    "NAD" => "Namibian Dollar",
    "NGN" => "Nigerian Naira",
    "NIO" => "Nicaraguan Córdoba",
    "NOK" => "Norwegian Krone",
    "NPR" => "Nepalese Rupee",
    "NZD" => "New Zealand Dollar",
    "OMR" => "Omani Rial",
    "PAB" => "Panamanian Balboa",
    "PEN" => "Peruvian Nuevo Sol",
    "PGK" => "Papua New Guinean Kina",
    "PHP" => "Philippine Peso",
    "PKR" => "Pakistani Rupee",
    "PLN" => "Polish Zloty",
    "PYG" => "Paraguayan Guarani",
    "QAR" => "Qatari Rial",
    "RON" => "Romanian Leu",
    "RSD" => "Serbian Dinar",
    "RUB" => "Russian Ruble",
    "RWF" => "Rwandan Franc",
    "SAR" => "Saudi Riyal",
    "SBD" => "Solomon Islands Dollar",
    "SCR" => "Seychellois Rupee",
    "SDG" => "South Sudanese Pound",
    "SEK" => "Swedish Krona",
    "SGD" => "Singapore Dollar",
    "SHP" => "Saint Helena Pound",
    "SLE" => "Sierra Leonean Leone",
    "SLL" => "Sierra Leonean Leone",
    "SOS" => "Somali Shilling",
    "SRD" => "Surinamese Dollar",
    "STD" => "São Tomé and Príncipe Dobra",
    "SVC" => "Salvadoran Colón",
    "SYP" => "Syrian Pound",
    "SZL" => "Swazi Lilangeni",
    "THB" => "Thai Baht",
    "TJS" => "Tajikistani Somoni",
    "TMT" => "Turkmenistani Manat",
    "TND" => "Tunisian Dinar",
    "TOP" => "Tongan Paʻanga",
    "TRY" => "Turkish Lira",
    "TTD" => "Trinidad and Tobago Dollar",
    "TWD" => "New Taiwan Dollar",
    "TZS" => "Tanzanian Shilling",
    "UAH" => "Ukrainian Hryvnia",
    "UGX" => "Ugandan Shilling",
    "USD" => "United States Dollar",
    "UYU" => "Uruguayan Peso",
    "UZS" => "Uzbekistan Som",
    "VEF" => "Venezuelan Bolívar Fuerte",
    "VES" => "Sovereign Bolivar",
    "VND" => "Vietnamese Dong",
    "VUV" => "Vanuatu Vatu",
    "WST" => "Samoan Tala",
    "XAF" => "CFA Franc BEAC",
    "XAG" => "Silver (troy ounce)",
    "XAU" => "Gold (troy ounce)",
    "XCD" => "East Caribbean Dollar",
    "XDR" => "Special Drawing Rights",
    "XOF" => "CFA Franc BCEAO",
    "XPF" => "CFP Franc",
    "YER" => "Yemeni Rial",
    "ZAR" => "South African Rand",
    "ZMK" => "Zambian Kwacha (pre-2013)",
    "ZMW" => "Zambian Kwacha",
    "ZWL" => "Zimbabwean Dollar"
];

?>

<style>
    .exchange-rates-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .exchange-rates-table tbody th, .exchange-rates-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
    }

    .exchange-rates-table tbody th {
        background-color: #f2f2f2;
        color: #333;
    }

    .exchange-rates-table td {
        color: #666;
    }

    .exchange-rates-table tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    .exchange-rates-table tr:hover {
        background-color: #ddd;
    }
</style>



<div style="max-width: 1000px; margin: 0 auto; font-family: 'Arial', sans-serif; padding: 20px;">
    <h2 style="text-align: center; font-size: 26px; color: #333; margin-bottom: 20px;">Quy đổi tiền tệ từ Vietcombank</h2>
    <div id="exchange-rates"></div>
    <br />

    <h2 style="text-align: center; font-size: 26px; color: #333; margin-bottom: 20px;">Quy đổi Tỷ giá Tiền tệ từ fixer.io </h2>

    <!-- Form chọn tiền tệ -->
    <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 30px;">
        <div style="flex: 1; text-align: center;">
            <label for="from_currency" style="font-size: 18px; color: #333;">Chọn đồng tiền</label>
            <select id="from_currency" style="font-size: 16px; width: 100%; max-width: 200px; border: 1px solid #ddd;">
                <?php foreach ($currencyList as $currencyCode): ?>
                    <option value="<?= $currencyCode ?>"><?= $currencyCode ?></option>
                <?php endforeach; ?>
            </select>
        </div>

        <div style="flex: 1; text-align: center;">
            <label for="to_currency" style="font-size: 18px; color: #333;">Chuyển sang</label>
            <select id="to_currency" style="font-size: 16px; width: 100%; max-width: 200px; border: 1px solid #ddd;">
                <?php foreach ($currencyList as $currencyCode): ?>
                    <option value="<?= $currencyCode ?>"><?= $currencyCode ?></option>
                <?php endforeach; ?>
            </select>
        </div>

        <div style="flex: 1; text-align: center;">
            <label for="amount" style="font-size: 18px; color: #333;">Số tiền</label>
            <input type="number" id="amount" placeholder="Nhập số tiền" style="padding: 10px; font-size: 16px; width: 100%; max-width: 200px; border: 1px solid #ddd;" />
        </div>
    </div>

    <!-- Kết quả quy đổi -->
    <div style="text-align: center;">
        <h3 style="font-size: 20px; color: #333;">Kết quả:</h3>
        <p id="result" style="font-size: 22px; font-weight: bold; color: rgb(233, 95, 66);">Chưa có kết quả</p>
    </div>

    <!-- Bảng tỷ giá -->
    <h3 style="text-align: center; font-size: 24px; color: #333; margin-top: 50px;">Danh sách Tỷ giá Tiền tệ quy đổi từ EUR ngày <?= $currentDate ?> </h3>
    <table style="width: 100%; border-collapse: collapse; margin-top: 20px; background-color: #f9f9f9; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
        <thead style="background-color: rgb(233, 95, 66); color: white;">
        <tr>
            <th style="padding: 12px; text-align: left; font-size: 18px;">Mã Tiền Tệ</th>
            <th style="padding: 12px; text-align: left; font-size: 18px;">Tỷ Giá</th>
        </tr>
        </thead>
        <tbody>
        <?php foreach ($currencyRates as $currencyCode => $rate): ?>
            <tr style="border-bottom: 1px solid #ddd;">
                <td style="padding: 10px;"> (<?=isset($currencyNames[$currencyCode]) ? $currencyNames[$currencyCode] : 'Unknown' ?>) <strong><?= $currencyCode ?> </strong></td>
                <td style="padding: 10px;"><?= number_format($rate, 4) ?></td>
            </tr>
        <?php endforeach; ?>
        </tbody>
    </table>
</div>

<script>
    // Hàm tính tỷ giá chuyển đổi
    function calculateExchange() {
        const fromCurrency = document.getElementById('from_currency').value;
        const toCurrency = document.getElementById('to_currency').value;
        const amount = parseFloat(document.getElementById('amount').value);

        if (isNaN(amount) || amount <= 0) {
            document.getElementById('result').textContent = "Vui lòng nhập số tiền hợp lệ!";
            return;
        }

        const currencyRates = <?php echo json_encode($currencyRates); ?>;
        const fromRate = currencyRates[fromCurrency];
        const toRate = currencyRates[toCurrency];

        if (fromRate && toRate) {
            const convertedAmount = (amount / fromRate) * toRate;
            document.getElementById('result').textContent = `${amount} ${fromCurrency} = ${convertedAmount.toFixed(2)} ${toCurrency}`;
        } else {
            document.getElementById('result').textContent = "Không thể tính tỷ giá!";
        }
    }

    // Thêm sự kiện khi chọn lại tiền tệ hoặc nhập số tiền
    document.getElementById('from_currency').addEventListener('change', calculateExchange);
    document.getElementById('to_currency').addEventListener('change', calculateExchange);
    document.getElementById('amount').addEventListener('input', calculateExchange);
</script>

<script>
    const url = "https://portal.vietcombank.com.vn/Usercontrols/TVPortal.TyGia/pXML.aspx?b=68";

    fetch(url)
        .then(response => response.text())
        .then(xmlText => {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, "application/xml");

            const exrates = xmlDoc.querySelectorAll("Exrate");

            const displayDiv = document.getElementById("exchange-rates");

            let table = "<table class='exchange-rates-table'>";
            table += "<thead style='background: rgb(233, 95, 66); color: white;'><tr><th>Loại tiền tệ</th><th>Mua</th><th>Chuyển khoản</th><th>Bán</th></tr></thead><tbody>";

            exrates.forEach(exrate => {
                const currencyCode = exrate.getAttribute("CurrencyCode");
                const currencyName = exrate.getAttribute("CurrencyName");
                const buy = exrate.getAttribute("Buy");
                const transfer = exrate.getAttribute("Transfer");
                const sell = exrate.getAttribute("Sell");

                table += `<tr>
                    <td>${currencyName} <strong>(${currencyCode})</strong></td>
                    <td>${buy || "-"}</td>
                    <td>${transfer || "-"}</td>
                    <td>${sell || "-"}</td>
                </tr>`;
            });

            table += "</tbody></table>";

            displayDiv.innerHTML = table;
        })
        .catch(error => {
            document.getElementById('exchange-rates').innerHTML = "Chức năng chưa sẵn sàng";
            console.error("Lỗi khi lấy hoặc phân tích XML:", error);
        });
</script>

